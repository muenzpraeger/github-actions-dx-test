!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).WireService={})}(this,function(e){"use strict";const t="@wire",n="updated",i="connected",s="disconnected",c="connect",r="disconnect",o="config";function a(e,t,n){n.mutated||(n.mutated=new Set,Promise.resolve().then(function(e,t){const n=new Set,i=t.mutated;delete t.mutated,i.forEach(i=>{const s=function(e,t){let n=e[t.head];if(!t.tail)return n;const i=t.tail;for(let e=0,t=i.length;e<t&&null!=n;e++){const t=i[e];if("object"!=typeof n||!(t in n))return;n=n[t]}return n}(e,i);if(t.values[i.reference]===s)return;t.values[i.reference]=s;const c=t.listeners[i.head];for(let e=0,t=c.length;e<t;e++)n.add(c[e])}),s=n,c=t.values,s.forEach(e=>{const{listener:t,statics:n,reactives:i}=e,s=Object.create(null);if(i){const e=Object.keys(i);for(let t=0,n=e.length;t<n;t++){const n=e[t],r=c[i[n]];s[n]=r}}const r=Object.assign({},n,s);t.call(void 0,r)});var s,c}.bind(void 0,e,n))),n.mutated.add(t)}function l(e,t,n){const i=a.bind(void 0,e,t,n),s=function(e,t,n){const i=function e(t,n,i){i=i||[];if(!t||i.indexOf(t)>-1)return null;const s=Object.getOwnPropertyDescriptor(t,n);if(s)return s;const c=Object.getPrototypeOf(t);if(!c)return null;i.push(t);return e(c,n,i)}(e,t);let s,c,r;if(null===i||void 0===i.get&&void 0===i.set){let i=e[t];s=!0,c=function(){return i},r=function(e){i=e,n()}}else{const{set:t,get:o}=i;s=i.enumerable,r=function(i){t&&t.call(e,i),n()},c=function(){return o?o.call(e):void 0}}return{set:r,get:c,enumerable:s,configurable:!0}}(e,t.head,i);Object.defineProperty(e,t.head,s)}const u="ValueChangedEvent";class d{constructor(e){this.type=u,this.value=e}}const f="LinkContextEvent";class h{constructor(e,t){this.type=f,this.uid=e,this.callback=t}}function v(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function p(e){if(!e.includes("."))return{reference:e,head:e};const t=e.split(".");return{reference:e,head:t.shift(),tail:t}}class b{constructor(e,t,n,i,s){this._cmp=e,this._def=t,this._context=n,this._wireDef=i,this._wireTarget=s}addEventListener(e,u){switch(e){case c:this._context[t][i].push(u);break;case r:this._context[t][s].push(u);break;case o:{const e=this._wireDef.params,i=this._wireDef.static;let s;if(!e||0===(s=Object.keys(e)).length){const e=i||Object.create(null);return void u.call(void 0,e)}const c={listener:u,statics:i,reactives:e},r=this._context[t][n];s.forEach(t=>{const n=p(e[t]);let i=r.listeners[n.head];i?i.push(c):(i=[c],r.listeners[n.head]=i,l(this._cmp,n,r)),a(this._cmp,n,r)});break}default:throw new Error(`unsupported event type ${e}`)}}removeEventListener(e,a){switch(e){case c:v(this._context[t][i],a);break;case r:v(this._context[t][s],a);break;case o:{const e=this._context[t][n].listeners,i=this._wireDef.params;i&&Object.keys(i).forEach(t=>{const n=p(i[t]),s=e[n.head];s&&function(e,t){for(let n=0,i=e.length;n<i;n++)if(e[n].listener===t)return void e.splice(n,1)}(s,a)});break}default:throw new Error(`unsupported event type ${e}`)}}dispatchEvent(e){if(e instanceof d){const t=e.value;return this._wireDef.method?this._cmp[this._wireTarget](t):this._cmp[this._wireTarget]=t,!1}if(e instanceof h){const{uid:t,callback:n}=e,i=new CustomEvent(t,{bubbles:!0,composed:!0,detail(...e){n(...e)}});return this._cmp.dispatchEvent(i),!1}if("WireContextEvent"===e.type)return this._cmp.dispatchEvent(e);throw new Error(`Invalid event ${e}.`)}}const w=new Map;function m(e){for(let t=0,n=e.length;t<n;++t)e[t].call(void 0)}const _={wiring:(e,c,r,o)=>{const a=o[t]=Object.create(null);a[i]=[],a[s]=[],a[n]={listeners:{},values:{}};const l=r.wire,u=Object.keys(l);for(let t=0,n=u.length;t<n;t++){const n=u[t],i=l[n],s=w.get(i.adapter);if(s){const t=new b(e,r,o,i,n);s({dispatchEvent:t.dispatchEvent.bind(t),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)})}}},connected:(e,n,s,c)=>{let r;s.wire&&(r=c[t][i])&&m(r)},disconnected:(e,n,i,c)=>{let r;i.wire&&(r=c[t][s])&&m(r)}};e.LinkContextEvent=h,e.ValueChangedEvent=d,e.register=function(e,t){w.set(e,t)},e.registerWireService=function(e){e(_)},Object.defineProperty(e,"__esModule",{value:!0})});
